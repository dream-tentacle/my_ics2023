# PA3 必答题
###  必答题(需要在实验报告中回答) - 理解上下文结构体的前世今生
你会在`__am_irq_handle()`中看到有一个上下文结构指针`c`, `c`指向的上下文结构究竟在哪里? 这个上下文结构又是怎么来的? 具体地, 这个上下文结构有很多成员, 每一个成员究竟在哪里赋值的? `$ISA-nemu.h`, `trap.S`, 上述讲义文字, 以及你刚刚在NEMU中实现的新指令, 这四部分内容又有什么联系?

答：c指向的上下文结构在`trap.S`中，它的首地址存在sp中。它是由`trap.S`中`addi sp, sp, -CONTEXT_SIZE`所分配的，每一个成员都是在`jal __am_irq_handle`指令前赋值的，具体而言，通用寄存器在MAP步骤宏定义展开后一个个存储，然后再将`mcause,mstatus,mepc`用STORE和对应宏定义展开的偏移量存储的。`$ISA-nemu.h`定义了Context的各个内容顺序，让C语言代码中能够以正确顺序访问；`trap.S`申请空间并存储了各代码，讲义就是将`trap.S`的过程讲了一遍，而我刚刚在NEMU实现的新指令例如`csrr`则是`trap.S`所使用到的指令。